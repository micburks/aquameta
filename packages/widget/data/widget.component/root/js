import html from '/db/widget/core/html.js';
import React from '/db/widget/dep/react.js';
import {client, database, query} from '/db/widget/core/datum.js';
import styled from '/db/widget/dep/styled-components.js';
import SlideContainer from '/db/widget/component/slide-container.js';
import Slide from '/db/widget/component/slide.js';

const datum = query(
  client.endpoint(),
  database.select(
    // database.orderByAsc('number', database.relation('pres.slide'))
    database.relation('pres.slide')
  )
);

function useDatum (datum) {
  const [state, setState] = React.useState([]);
  React.useEffect(() => {
    datum.then(rows => {
      setState(rows);
    });
  }, [datum])
  return state;
}

export default function Root() {
  const slides = useDatum(datum);
  const [slideIndex, setSlideIndex] = React.useState(0);
  const slide = slides[slideIndex];

  function moveSlide(toIndex) {
    if (toIndex >= 0 && toIndex < slides.length) {
      setSlideIndex(toIndex);
    }
  }

  return slide
    ? html`
      <${SlideContainer}
        previous=${() => moveSlide(slideIndex-1)}
        previousDisabled=${slideIndex === 0}
        next=${() => moveSlide(slideIndex+1)}
        nextDisabled=${slideIndex === (slides.length - 1)}
      >
        <${Slide} slide=${slide}/>
      <//>
    `
    : 'Presentation loading';
}
